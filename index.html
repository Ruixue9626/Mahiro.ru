<!DOCTYPE html><html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>PDF 資源平台</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
    .hidden { display: none; }
    iframe { width: 100%; height: 500px; border: none; }
  </style>
</head>
<body>
<div class="container">
  <h2>📢 使用者規範 / 免責聲明</h2>
  <ul>
    <li>1. 本站所有資源、帳號由 GitHub 提供，無盜用或非法行為。</li>
    <li>2. 抄作業導致負面影響，管理者不負責。</li>
    <li>3. 使用問題由使用者自行承擔。</li>
    <li>4. 嚴禁利用本站作弊。</li>
  </ul>
  <button onclick="acceptDisclaimer()">我已閱讀並同意</button>  <div id="login" class="hidden">
    <h3>登入</h3>
    <input id="user" placeholder="帳號"><br><br>
    <input id="pass" type="password" placeholder="密碼"><br><br>
    <button onclick="login()">登入</button>
    <p id="error" style="color:red"></p>
  </div>  <div id="app" class="hidden">
    <h3>PDF 檔案列表</h3>
    <div id="pdfList"></div>
    <div id="uploadArea" class="hidden">
      <hr>
      <h4>上傳 PDF</h4>
      <input type="file" id="pdfFile"><br><br>
      <button onclick="uploadPdf()">上傳</button>
      <p id="uploadStatus"></p>
    </div>
    <div id="viewer"></div>
    <br><button onclick="logout()">登出</button>
  </div>
</div><script>
  const USERS = {
    user01: { pw: '0123', role: 'user' },
    Ruixue: { pw: '0325', role: 'admin' }
  };
  let currentUser = null;

  function acceptDisclaimer() {
    document.getElementById('login').classList.remove('hidden');
  }

  function login() {
    const u = document.getElementById('user').value;
    const p = document.getElementById('pass').value;
    const error = document.getElementById('error');
    if (USERS[u] && USERS[u].pw === p) {
      currentUser = { name: u, role: USERS[u].role };
      document.getElementById('login').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      if (currentUser.role === 'admin') {
        document.getElementById('uploadArea').classList.remove('hidden');
      }
      fetchPdfs();
    } else {
      error.textContent = '帳密錯誤';
    }
  }

  function logout() {
    location.reload();
  }

  function fetchPdfs() {
    fetch('/api/pdfs')
      .then(res => res.json())
      .then(files => {
        const list = document.getElementById('pdfList');
        list.innerHTML = '';
        files.forEach(f => {
          const a = document.createElement('a');
          a.textContent = f;
          a.href = '#';
          a.onclick = () => viewPdf(f);
          a.style.display = 'block';
          list.appendChild(a);
        });
      });
  }

  function viewPdf(filename) {
    const viewer = document.getElementById('viewer');
    viewer.innerHTML = `<iframe src="/uploads/${filename}#toolbar=0&navpanes=0"></iframe>`;
  }

  function uploadPdf() {
    const fileInput = document.getElementById('pdfFile');
    const status = document.getElementById('uploadStatus');
    const file = fileInput.files[0];
    if (!file || !file.name.endsWith('.pdf')) {
      alert('請選擇 PDF 檔案');
      return;
    }
    const formData = new FormData();
    formData.append('pdf', file);
    fetch('/api/upload', { method: 'POST', body: formData })
      .then(res => res.json())
      .then(data => {
        status.textContent = '✅ 上傳成功：' + data.filename;
        fetchPdfs();
      })
      .catch(() => status.textContent = '❌ 上傳失敗');
  }
</script></body>
</html>
